<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>

  <script type="module" src="/node_modules/vl-ui-checkbox/dist/vl-checkbox.js"></script>

  <script type="module" src="../../src/vl-map-all.js"></script>
</head>

<body>
  <test-fixture id="vl-map-layer-switcher-fixture">
    <template>
      <vl-map>
        <vl-map-side-sheet>
          <vl-map-layer-switcher></vl-map-layer-switcher>
        </vl-map-side-sheet>
        <vl-map-features-layer data-vl-name="layer-1"></vl-map-features-layer>
        <vl-map-features-layer data-vl-name="layer-2"></vl-map-features-layer>
        <vl-map-features-layer data-vl-name="layer-3"></vl-map-features-layer>
      </vl-map>
    </template>
  </test-fixture>

  <test-fixture id="vl-map-layer-switcher-custom-fixture">
    <template>
      <vl-map>
        <vl-map-side-sheet>
          <vl-map-layer-switcher>
            <vl-checkbox data-vl-label="Optie 1" data-vl-layer="layer-1"></vl-checkbox>
          </vl-map-layer-switcher>
        </vl-map-side-sheet>
        <vl-map-features-layer data-vl-name="layer-1"></vl-map-features-layer>
        <vl-map-features-layer data-vl-name="layer-2"></vl-map-features-layer>
        <vl-map-features-layer data-vl-name="layer-3"></vl-map-features-layer>
      </vl-map>
    </template>
  </test-fixture>

  <script>
    suite('vl-map-layer-switcher', () => {
      setup((done) => {
        customElements.whenDefined('vl-map').then(() => {
          customElements.whenDefined('vl-map-layer-switcher').then(() => {
            customElements.whenDefined('vl-checkbox').then(() => done());
          });
        });
      });

      test('wanneer er geen layer input child elementen aanwezig zijn, zullen deze automatisch gegenereerd worden', (done) => {
        const map = fixture('vl-map-layer-switcher-fixture');
        const layerSwitcher = map.querySelector('vl-map-layer-switcher');
        map.ready.then(() => {
          const layers = map.nonBaseLayers;
          assert.lengthOf(layerSwitcher._layerInputs, 3);
          layers.forEach((layer, index) => assert.equal(layerSwitcher._layerInputs[index].getAttribute('data-vl-label'), layer.getAttribute('data-vl-name')));
          layers.forEach((layer, index) => assert.equal(layerSwitcher._layerInputs[index].getAttribute('data-vl-layer'), layer.getAttribute('data-vl-name')));
          done();
        });
      });

      test('wanneer er layer input child elementen aanwezig zijn, zullen er geen extra input elementen gegenereerd worden', (done) => {
        const map = fixture('vl-map-layer-switcher-custom-fixture');
        const layerSwitcher = map.querySelector('vl-map-layer-switcher');
        map.ready.then(() => {
          assert.lengthOf(layerSwitcher._layerInputs, 1);
          done();
        });
      });

      test('een change event van een element met een layer attribuut zal de zichtbaarheid van de gekoppelde laag wijzigen', (done) => {
        const map = fixture('vl-map-layer-switcher-custom-fixture');
        const checkbox = map.querySelector('vl-map-layer-switcher vl-checkbox');
        map.ready.then(() => {
          const layer = map.nonBaseLayers[0];
          assert.isTrue(layer.visible);
          checkbox.addEventListener('change', () => {
            setTimeout(() => {
              assert.isFalse(layer.visible);
              done();
            });
          });
          map.ready.then(() => checkbox.toggle());
        });
      });
    });
  </script>
</body>

</html>
