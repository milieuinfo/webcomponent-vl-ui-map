import{define,vlElement}from"/node_modules/vl-ui-core/dist/vl-core.min.js";import{OlGeoJSON,OlLoadingstrategy,OlStyle,OlStyleFill,OlStyleStroke,OlTileLayer,OlVectorLayer,OlVectorSource,OlWMTSSource}from"/node_modules/vl-mapactions/dist/vl-mapactions.js";import{optionsFromCapabilities}from"/node_modules/ol/source/WMTS.js";import WMTSCapabilities from"/node_modules/ol/format/WMTSCapabilities.js";export class VlMapBaseLayer extends(vlElement(HTMLElement)){async connectedCallback(){await this._configureMap()}get type(){return this.getAttribute("type")||"wmts"}get url(){return this.getAttribute("url")}get layer(){return this.getAttribute("layer")}get title(){return this.getAttribute("title")}get _map(){if(this.parentNode)return this.parentNode.map}get _projection(){if(this.parentNode)return this.parentNode._projection}async _WMTSSource(){return this._wmtsSource=this._wmtsSource||await this._createWMTSSource(),this._wmtsSource}get _vectorSource(){return this._createdVectorSource=this._createdVectorSource||this._createVectorSource(),this._createdVectorSource}async _configureMap(){this._map&&(this._map.addBaseLayerAndOverlayMapLayer(await this._createBaseLayer(),await this._createBaseLayer()),this._map.render())}async _createWMTSSource(){const e=new URL(this.url);e.search=new URLSearchParams({request:"getcapabilities",service:"wmts",version:"1.0.0"});const t=await fetch(e.href).then((e=>e.text())),r=new WMTSCapabilities,a=optionsFromCapabilities(r.read(t),{layer:this.layer,matrixSet:"BPL72VL"});return new OlWMTSSource(a)}_createVectorSource(){const e=this;return new OlVectorSource({format:new OlGeoJSON({dataProjection:e._projection}),url:function(){return e.url+"&typeName="+e.layer},strategy:OlLoadingstrategy.bbox})}async _createBaseLayer(){switch(this.type){case"wmts":return new OlTileLayer({title:this.title,type:"base",source:await this._WMTSSource()});case"wfs":return new OlVectorLayer({source:this._vectorSource,style:new OlStyle({stroke:new OlStyleStroke({color:"rgba(0, 0, 0, 1.0)",width:1}),fill:new OlStyleFill({color:"rgba(255, 0, 0, 1.0)"})})})}}}define("vl-map-baselayer",VlMapBaseLayer);