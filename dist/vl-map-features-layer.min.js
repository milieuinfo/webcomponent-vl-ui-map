import{define}from"/node_modules/vl-ui-core/dist/vl-core.min.js";import{VlMapVectorLayer}from"/node_modules/vl-ui-map/dist/vl-map-vector-layer.min.js";import{OlVectorSource,OlGeoJSON,OlClusterSource,OlPoint}from"/node_modules/vl-mapactions/dist/vl-mapactions.js";export class VlMapFeaturesLayer extends VlMapVectorLayer{static get _observedAttributes(){return VlMapVectorLayer._observedAttributes.concat(["auto-extent","features"])}constructor(){super(),this._geoJSON=new OlGeoJSON,this._source=this.__createSource(),this._layer=this._createLayer()}async connectedCallback(){await super.connectedCallback(),this._autoZoomToExtent()}get features(){return this.__featuresSource?this.__featuresSource.getFeatures():this._featuresFromAttribute}get _featuresFromAttribute(){const e=this.getAttribute("features");return e?this.__readGeoJsonFeatures(e):[]}set features(e){this.setAttribute("features",JSON.stringify(e))}get _autoExtent(){return null!=this.getAttribute("auto-extent")}get _autoExtentMaxZoom(){return this.getAttribute("auto-extent-max-zoom")}get cluster(){return null!=this.getAttribute("cluster")}get _clusterDistance(){return this.getAttribute("cluster-distance")}removeFeaturesStyle(){this.__featuresSource&&this.__featuresSource.getFeatures()&&this.__featuresSource.getFeatures().forEach((e=>{e.setStyle(null)}))}getFeature(e){if(this.__featuresSource&&this.__featuresSource.getFeatures())return this.__featuresSource.getFeatures().filter((t=>t.getId()===e))[0]}getCluster(e){if(this._layer)return this._layer.getSource().getFeatures().filter((t=>{const r=t.get("features");return!!r&&r.some((t=>t.getId()===e))}))[0]}async zoomToExtent(e){this.mapElement&&this.boundingBox&&this.mapElement.zoomTo(this.boundingBox,e)}clearFeatures(){this.__featuresSource&&(this.__featuresSource.clear(),this._featuresChanged())}addFeature(e){this.__featuresSource&&(this.__featuresSource.addFeatures([this._geoJSON.readFeature(e)]),this._featuresChanged())}addFeatureCollection(e){this.__featuresSource&&(this.__featuresSource.addFeatures(this._geoJSON.readFeatures(e)),this._featuresChanged())}_autoExtentChangedCallback(){this._autoZoomToExtent()}_featuresChangedCallback(e,t){t&&this._layer&&(this.__featuresSource.clear(),this.__featuresSource.addFeatures(this.__readGeoJsonFeatures(t)),this._featuresChanged())}_featuresChanged(){this._autoZoomToExtent(),this.rerender()}_autoZoomToExtent(){this._autoExtent&&this.zoomToExtent(this._autoExtentMaxZoom)}get boundingBox(){if(this.__featuresSource&&this.__featuresSource.getFeatures().length>0)return this.__featuresSource.getExtent()}__createSource(){const e=new OlVectorSource({features:this.features});return this.cluster?this.__createClusterSource(e):e}__createClusterSource(e){return new OlClusterSource({distance:this._clusterDistance,source:e,geometryFunction:e=>{const t=e.getGeometry();return t instanceof OlPoint?t:this.__ignoreClustering()}})}get __featuresSource(){return this.cluster&&this.source?this.source.getSource():this.source}__ignoreClustering(){return null}__readGeoJsonFeatures(e){return this._geoJSON.readFeatures(e)}}define("vl-map-features-layer",VlMapFeaturesLayer);