import{define}from"/node_modules/vl-ui-core/dist/vl-core.min.js";import{VlMapVectorLayer}from"/node_modules/vl-ui-map/dist/vl-map-vector-layer.min.js";import{OlVectorSource,OlGeoJSON,OlClusterSource,OlPoint}from"/node_modules/vl-mapactions/dist/vl-mapactions.js";export class VlMapFeaturesLayer extends VlMapVectorLayer{static get _observedAttributes(){return["auto-extent","features"]}constructor(){super(),this._geoJSON=new OlGeoJSON,this._source=this.__createSource(),this._layer=this._createLayer()}async connectedCallback(){await super.connectedCallback(),this.mapElement&&this._autoZoomToExtent()}get features(){return this.source?this.source.getFeatures():this._featuresFromAttribute}get _featuresFromAttribute(){const e=this.getAttribute("features");return e?this.__readGeoJsonFeatures(e):[]}set features(e){this.setAttribute("features",JSON.stringify(e))}get _autoExtent(){return null!=this.getAttribute("auto-extent")}get _autoExtentMaxZoom(){return this.getAttribute("auto-extent-max-zoom")}get cluster(){return null!=this.getAttribute("cluster")}get _clusterDistance(){return this.getAttribute("cluster-distance")}removeFeaturesStyle(){this.source&&this.source.getFeatures()&&this.source.getFeatures().forEach((e=>{e.setStyle(null)}))}getFeature(e){if(this.source&&this.source.getFeatures())return this.source.getFeatures().filter((t=>t.getId()===e))[0]}getCluster(e){if(this._layer)return this._layer.getSource().getFeatures().filter((t=>{const r=t.get("features");return!!r&&r.some((t=>t.getId()===e))}))[0]}async zoomToExtent(e){this.mapElement.zoomTo(this.__boundingBox,e)}clearFeatures(){this._source&&(this._source.clear(),this._featuresChanged())}addFeature(e){this._source&&(this._source.addFeatures([this._geoJSON.readFeature(e)]),this._featuresChanged())}addFeatureCollection(e){this._source&&(this._source.addFeatures(this._geoJSON.readFeatures(e)),this._featuresChanged())}_autoExtentChangedCallback(){this._autoZoomToExtent()}_featuresChangedCallback(e,t){t&&this._layer&&(this.source.clear(),this.source.addFeatures(this.__readGeoJsonFeatures(t)),this._featuresChanged())}_featuresChanged(){this._autoZoomToExtent(),this.rerender()}_autoZoomToExtent(){this._autoExtent&&this.zoomToExtent(this._autoExtentMaxZoom)}get __boundingBox(){if(this.source&&this.source.getFeatures().length>0)return this.source.getExtent()}__createSource(){const e=new OlVectorSource({features:this.features});return this.cluster?this.__createClusterSource(e):e}__createClusterSource(e){return new OlClusterSource({distance:this._clusterDistance,source:e,geometryFunction:e=>{const t=e.getGeometry();return t instanceof OlPoint?t:this.__ignoreClustering()}})}__ignoreClustering(){return null}__readGeoJsonFeatures(e){return this._geoJSON.readFeatures(e)}}define("vl-map-features-layer",VlMapFeaturesLayer);